<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate Habit Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b0f14">

<style>
:root{
  --bg:#0b0f14;
  --card:#141922;
  --rowA:#161c26;
  --rowB:#121722;
  --border:#2a3244;
  --text:#ffffff;
  --muted:#9aa4b2;
  --accent:#00e676;
  --danger:#ff4d4d;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Segoe UI,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:18px;
  text-align:center;
  font-size:22px;
  font-weight:800;
  background:linear-gradient(135deg,#141e30,#243b55);
}
.container{
  max-width:1600px;
  margin:auto;
  padding:16px;
  display:grid;
  gap:16px;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
}
.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
input,select,button{
  background:#1b2230;
  color:var(--text);
  border:1px solid var(--border);
  padding:8px 12px;
  border-radius:10px;
  font-size:14px;
}
button{cursor:pointer}
button:hover{opacity:.85}

/* DASHBOARD */
.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
}
.stat{
  background:#1b2230;
  border-radius:14px;
  padding:16px;
}
.stat span{
  display:block;
  margin-top:6px;
  font-size:22px;
  font-weight:800;
}

/* TABLE */
.table-shell{
  border-radius:16px;
  border:1px solid var(--border);
  overflow:auto;          /* IMPORTANT: single scroll container */
  max-height:420px;
}
.table-wrapper{
  min-width:max-content;
}
.grid{
  display:grid;
  grid-template-columns:240px repeat(var(--days), 44px) 70px 60px;
}
.table-header{
  position:sticky;
  top:0;
  z-index:10;
  background:#1b2230;
}
.table-header div{
  padding:10px;
  text-align:center;
  border-right:1px solid var(--border);
  font-weight:700;
}
.body{
  overflow:visible;
}
.row:nth-child(even){background:var(--rowA)}
.row:nth-child(odd){background:var(--rowB)}
.cell{
  padding:8px;
  text-align:center;
  border-right:1px solid var(--border);
}
.habit{
  font-weight:700;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.box{
  width:22px;
  height:22px;
  border-radius:6px;
  background:#2a3344;
  cursor:pointer;
}
.box.checked{
  background:var(--accent);
  box-shadow:0 0 6px #00e67688;
}
.delete{
  cursor:pointer;
  color:var(--muted);
}
.delete:hover{color:var(--danger)}

/* YEARLY */
.yearly{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(90px,1fr));
  gap:10px;
}
.month-box{
  background:#1b2230;
  border-radius:12px;
  padding:10px;
  text-align:center;
}

/* ================= FIXED COLUMNS ================= */

/* Freeze Habit column (left) */
.row .cell:first-child{
  position:sticky;
  left:0;
  z-index:6;
  background:#1b2230;
  box-shadow:2px 0 6px rgba(0,0,0,0.4);
}
.table-header div:first-child{
  position:sticky;
  left:0;
  z-index:7;
  background:#1b2230;
  box-shadow:2px 0 6px rgba(0,0,0,0.4);
}

/* Freeze % column (right) */
.row .cell:nth-last-child(2){
  position:sticky;
  right:60px; /* width of delete column */
  z-index:6;
  background:#1b2230;
  box-shadow:-2px 0 6px rgba(0,0,0,0.4);
}
.table-header div:nth-last-child(2){
  position:sticky;
  right:60px;
  z-index:7;
  background:#1b2230;
  box-shadow:-2px 0 6px rgba(0,0,0,0.4);
}

/* Today highlight */
.today{
  background:rgba(0,230,118,0.18)!important;
}
</style>
</head>

<body>

<header>ULTIMATE HABIT TRACKER</header>

<div class="container">

<!-- CONTROLS -->
<div class="card controls">
  <select id="year"></select>
  <select id="month"></select>
  <input id="newHabit" placeholder="Add new habit">
  <button onclick="addHabit()">Add</button>
</div>

<!-- DASHBOARD -->
<div class="card dashboard">
  <div class="stat">üìà Overall<span id="overall">0%</span></div>
  <div class="stat">üèÜ Best<span id="best">-</span></div>
  <div class="stat">‚ö†Ô∏è Weakest<span id="worst">-</span></div>
</div>

<!-- TRACKER -->
<div class="card table-shell">
  <div class="table-wrapper">
    <div id="header" class="grid table-header"></div>
    <div id="body" class="body"></div>
  </div>
</div>

<!-- YEARLY -->
<div class="card">
  <h3>üìÜ Yearly Overview</h3>
  <div id="yearly" class="yearly"></div>
</div>

</div>

<script>
/* ---------------- DATA ---------------- */
let habits = JSON.parse(localStorage.getItem("habit-list")) || [
  "Daily Exercise","Drink 2L Water","Read 10 Pages",
  "Sleep Before 11 PM","Meditation","No Junk Food","Work on Goals"
];

const yearSel=document.getElementById("year");
const monthSel=document.getElementById("month");
const header=document.getElementById("header");
const body=document.getElementById("body");

const now=new Date();
const currentYear=now.getFullYear();

/* YEAR SELECT */
for(let y=currentYear-5;y<=currentYear+10;y++){
  let o=document.createElement("option");
  o.value=y;o.text=y;
  if(y===currentYear)o.selected=true;
  yearSel.appendChild(o);
}

/* MONTH SELECT */
for(let m=0;m<12;m++){
  let o=document.createElement("option");
  o.value=m;
  o.text=new Date(2025,m).toLocaleString("default",{month:"long"});
  if(m===now.getMonth())o.selected=true;
  monthSel.appendChild(o);
}

function daysInMonth(y,m){return new Date(y,m+1,0).getDate();}
function key(y,m,h,d){return `${y}-${m}-${h}-${d}`;}

function isTodayCell(y,m,d){
  const t=new Date();
  return y===t.getFullYear() && m===t.getMonth() && d===t.getDate();
}

function saveHabits(){
  localStorage.setItem("habit-list",JSON.stringify(habits));
}

function addHabit(){
  let i=document.getElementById("newHabit");
  if(!i.value.trim())return;
  habits.push(i.value.trim());
  saveHabits();i.value="";render();
}

function removeHabit(h){
  if(!confirm(`Delete "${h}"?`))return;
  habits=habits.filter(x=>x!==h);
  saveHabits();render();
}

function toggle(h,d){
  let y=+yearSel.value,m=+monthSel.value;
  let k=key(y,m,h,d);
  localStorage.setItem(k,localStorage.getItem(k)!=="true");
  render();
}

/* ---------------- RENDER ---------------- */
function render(){
  let y=+yearSel.value,m=+monthSel.value;
  let days=daysInMonth(y,m);

  header.style.setProperty("--days",days);
  body.style.setProperty("--days",days);
  header.innerHTML="";body.innerHTML="";

  header.innerHTML+="<div>Habit</div>";
  for(let d=1;d<=days;d++){
    const cls=isTodayCell(y,m,d)?"today":"";
    header.innerHTML+=`<div class="${cls}">${d}</div>`;
  }
  header.innerHTML+="<div>%</div><div>üóëÔ∏è</div>";

  let best={n:"-",v:-1},worst={n:"-",v:101},total=0;

  habits.forEach(h=>{
    let done=0;
    let row=document.createElement("div");
    row.className="grid row";
    row.style.setProperty("--days",days);

    row.innerHTML+=`<div class="cell habit">${h}</div>`;

    for(let d=1;d<=days;d++){
      let c=localStorage.getItem(key(y,m,h,d))==="true";
      if(c)done++;
      const tCls=isTodayCell(y,m,d)?"today":"";
      row.innerHTML+=`
        <div class="cell ${tCls}">
          <div class="box ${c?"checked":""}" onclick="toggle('${h}',${d})"></div>
        </div>`;
    }

    let p=Math.round(done/days*100);
    total+=p;
    if(p>best.v)best={n:h,v:p};
    if(p<worst.v)worst={n:h,v:p};

    row.innerHTML+=`<div class="cell">${p}%</div>`;
    row.innerHTML+=`<div class="cell delete" onclick="removeHabit('${h}')">üóëÔ∏è</div>`;
    body.appendChild(row);
  });

  document.getElementById("overall").innerText=Math.round(total/habits.length)+"%";
  document.getElementById("best").innerText=best.n;
  document.getElementById("worst").innerText=worst.n;
  yearly(y);
}

function yearly(y){
  let box=document.getElementById("yearly");
  box.innerHTML="";
  for(let m=0;m<12;m++){
    let days=daysInMonth(y,m),sum=0;
    habits.forEach(h=>{
      let d=0;
      for(let i=1;i<=days;i++)
        if(localStorage.getItem(key(y,m,h,i))==="true")d++;
      sum+=d/days*100;
    });
    box.innerHTML+=`<div class="month-box">
      ${new Date(y,m).toLocaleString("default",{month:"short"})}<br>
      <b>${Math.round(sum/habits.length)}%</b>
    </div>`;
  }
}

yearSel.onchange=render;
monthSel.onchange=render;
render();

/* PWA */
if("serviceWorker"in navigator){
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
